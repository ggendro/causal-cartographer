# A Causal World Modelling Agent


<img src="assets/dialog-example.png" alt="Example of Agent Dialog" width="1200"/>


## Introduction

Repository for the Causal World Modelling Agent project. This framework is an LLM-based approach for the extraction of causal graphs from natural language text and composition of causal world models. The approach builds a causal model and verifies its consistency across counterfactual scenarios built from multiples sources.


## Installation


```bash
python -m venv env
source env/bin/activate
pip install -r requirements.txt
```

On Windows, use `env\Scripts\activate` or `env\Scripts\Activate.ps1` instead of `source env/bin/activate`.

A subscription to an LLM API provider may be required.


## Usage

The framework provides several scripts for different tasks:

### Causal Discovery

Use `run_discovery.py` to extract causal graphs from text data:

```bash
# Basic usage
python src/run_discovery.py --api_key YOUR_API_KEY

# Custom data directory and model
python src/run_discovery.py --data_dir path/to/data --model_base model-name --api_key YOUR_API_KEY

# Resume from a previous graph
python src/run_discovery.py --resume path/to/graph.gml --api_key YOUR_API_KEY

# Process limited number of documents
python src/run_discovery.py --max_docs 10 --api_key YOUR_API_KEY
```

### Causal Inference and Evaluation

Use `run_evaluation.py` to evaluate causal inference on existing graphs:

```bash
# Evaluate using an existing graph
python src/run_evaluation.py --graph_path path/to/graph.gml --api_key YOUR_API_KEY

# Evaluate using a dataset
python src/run_evaluation.py --dataset_path path/to/dataset.csv --api_key YOUR_API_KEY

# Generate dataset without evaluation
python src/run_evaluation.py --graph_path path/to/graph.gml --build_dataset_only --dataset_save_path data/dataset --api_key YOUR_API_KEY

# Customize inference parameters
python src/run_evaluation.py --graph_path path/to/graph.gml --max_interventions 2 --mixing_functions none --api_key YOUR_API_KEY
```


### Graph Visualization Tool

The project includes an interactive graph visualization tool that helps you explore causal graphs generated by the agents. The visualization tool provides features like clustering, world attribute filtering, and detailed node/edge information.

To use the visualization tool:

```bash
# Launch the visualization tool
python src/visualize_graph.py

# Open a specific graph file directly
python src/visualize_graph.py --graph data/results/causal_graph_2025-03-04_13-36-23.gml

# Customize the port (default is 5000)
python src/visualize_graph.py --port 8080
```

#### Features

- **Interactive Graph Exploration**: Pan, zoom, and click on nodes/edges to view attributes
- **Cluster-Based Visualization**: Nodes are automatically clustered and color-coded based on their connectivity
- **World Attribute Filtering**: Highlight nodes that share specific world attributes
- **Graph Physics Controls**: Adjust the physics simulation for better visualization of large graphs
- **Information Panel**: View detailed information about nodes and edges by clicking on them


## List of Agents

| Agent Name | Description | Standalone | Component | Dependencies | Implementation |
|------------|-------------|------------|-----------|--------------|----------------|
| `atomic_discovery_agent` | Agent that builds a simple networkx causal graph from a text snippet using pre-trained commonsense knowledge. | :white_check_mark: | :white_check_mark: | `networkx` | :white_check_mark: |
| `atomic_rag_agent` | Agent that extracts causal graphs using retrieval augmented generation (RAG) for improved contextual understanding. | :white_check_mark: | :white_check_mark: | `networkx` | :white_check_mark: |
| `self_iterative_agent` | Agent that recursively builds a networkx causal graph from a text snippet or a topic. Stops after a predefined number of steps. | :white_check_mark: | :white_check_mark: | `networkx` | :white_check_mark: |
| `causal_inference_agent` | Agent that performs counterfactual causal inference on a networkx causal graph using an LLM as an inference engine. | :white_check_mark: | :white_check_mark: | | :white_check_mark: |
| `backward_inference_agent` | Agent that performs backward causal reasoning from effects to potential causes. | :white_check_mark: | :white_check_mark: | | :white_check_mark: |
| `counterfactual_text_generation_agent` | Agent that generates counterfactual scenarios based on causal graphs. | :white_check_mark: | :white_check_mark: | | :white_check_mark: |


## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.











